<div class="team-container">
  <!-- Hero Section -->
  <div class="team-hero">
    <div class="hero-content">
      <div class="hero-text">
        <div class="hero-icon">
          <mat-icon>groups</mat-icon>
        </div>
        <h1>Trabajo en Equipo</h1>
        <p>Gestiona el rendimiento y progreso de cada miembro del equipo de manera eficiente</p>
      </div>
      <button mat-raised-button color="primary" (click)="openAddMemberModal()" class="add-member-btn">
        <mat-icon>person_add</mat-icon>
        Añadir Miembro
      </button>
    </div>
  </div>

  <!-- KPIs Section -->
  <div class="team-kpis">
    <div class="kpis-grid">
      <div class="kpi-card kpi-members">
        <div class="kpi-icon">
          <mat-icon>people</mat-icon>
        </div>
        <div class="kpi-content">
          <span class="kpi-number">{{ teamMembers().length }}</span>
          <span class="kpi-label">Miembros</span>
        </div>
      </div>
      <div class="kpi-card kpi-tasks">
        <div class="kpi-icon">
          <mat-icon>assignment</mat-icon>
        </div>
        <div class="kpi-content">
          <span class="kpi-number">{{ getTotalTasks() }}</span>
          <span class="kpi-label">Tareas</span>
        </div>
      </div>
      <div class="kpi-card kpi-progress">
        <div class="kpi-icon">
          <mat-icon>trending_up</mat-icon>
        </div>
        <div class="kpi-content">
          <span class="kpi-number">{{ getAverageCompletion() }}%</span>
          <span class="kpi-label">Promedio</span>
        </div>
      </div>
    </div>
  </div>
  
        @if (teamMembers().length === 0) {
          <div class="empty-team-state">
            <div class="empty-team-content">
              <div class="empty-team-animation">
                <app-lottie-animation 
                  animationPath="assets/animations/empty-box.json"
                  width="300px"
                  height="300px"
                  [loop]="true"
                  [autoplay]="true">
                </app-lottie-animation>
              </div>
              <h2 class="empty-team-title">¡Tu equipo está vacío!</h2>
              <p class="empty-team-description">
                Comienza construyendo tu equipo de trabajo añadiendo miembros.
                <br>
                Colabora y gestiona tareas de manera eficiente.
              </p>
              <button mat-raised-button color="primary" (click)="openAddMemberModal()" class="add-first-member-btn">
                <mat-icon>person_add</mat-icon>
                Añadir Primer Miembro
              </button>
            </div>
          </div>
        } @else {
          <div class="team-grid">
            @for (member of teamMembers(); track member.id) {
              <mat-card class="member-card">
               <mat-card-header>
                 <div class="member-info">
                   <mat-card-title>{{ member.name }}</mat-card-title>
                   <mat-card-subtitle>{{ member.role }}</mat-card-subtitle>
                 </div>
                 <div class="member-header-right">
                   <div class="traffic-light" [ngClass]="getTrafficLightClass(getMemberStats(member.name).total)">
                     <div class="light-dot"></div>
                   </div>
                   <div class="member-avatar" (click)="openWorkerProfileModal(member)" title="Ver perfil">
                     <span class="member-initials">{{ member.avatar }}</span>
                   </div>
                   <button 
                     mat-icon-button 
                     (click)="openDeleteMemberModal(member.name)"
                     class="delete-member-btn"
                     title="Eliminar miembro">
                     <mat-icon>delete</mat-icon>
                   </button>
                 </div>
               </mat-card-header>
        <mat-card-content>
          @if (getMemberStats(member.name).total > 0) {
            <div class="member-overview">
              <div class="overview-header">
                <h3>Estadísticas de Productividad</h3>
                <div class="member-status" [ngClass]="getMemberStatusClass(getMemberStats(member.name).completionRate)">
                  <mat-icon>{{ getMemberStatusIcon(getMemberStats(member.name).completionRate) }}</mat-icon>
                  <span>{{ getMemberStatusText(getMemberStats(member.name).completionRate) }}</span>
                </div>
              </div>
              
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-icon">
                    <mat-icon>assignment</mat-icon>
                  </div>
                  <span class="stat-number">{{ getMemberStats(member.name).total }}</span>
                  <span class="stat-label">Total</span>
                </div>
                <div class="stat-item completed">
                  <div class="stat-icon">
                    <mat-icon>check_circle</mat-icon>
                  </div>
                  <span class="stat-number">{{ getMemberStats(member.name).completed }}</span>
                  <span class="stat-label">Completadas</span>
                </div>
                <div class="stat-item in-progress">
                  <div class="stat-icon">
                    <mat-icon>hourglass_empty</mat-icon>
                  </div>
                  <span class="stat-number">{{ getMemberStats(member.name).inProgress }}</span>
                  <span class="stat-label">En Progreso</span>
                </div>
                <div class="stat-item not-started">
                  <div class="stat-icon">
                    <mat-icon>play_circle_outline</mat-icon>
                  </div>
                  <span class="stat-number">{{ getMemberStats(member.name).notStarted }}</span>
                  <span class="stat-label">Sin Iniciar</span>
                </div>
              </div>
              
              <div class="completion-section">
                <div class="completion-header">
                  <span class="completion-label">Progreso General</span>
                  <span class="completion-percentage">{{ getMemberStats(member.name).completionRate }}%</span>
                </div>
                <div class="completion-rate">
                  <div class="rate-bar">
                    <div class="rate-fill" [style.width.%]="getMemberStats(member.name).completionRate"></div>
                  </div>
                </div>
              </div>
              
              <div class="member-actions">
                <button mat-button class="action-btn view-tasks" (click)="viewMemberTasks(member.name)">
                  <mat-icon>visibility</mat-icon>
                  Ver Tareas
                </button>
                <button mat-button class="action-btn edit-profile" (click)="editMemberProfile(member)">
                  <mat-icon>edit</mat-icon>
                  Editar
                </button>
              </div>
            </div>
          } @else {
            <div class="no-tasks">
              <div class="no-tasks-icon">
                <mat-icon>inbox</mat-icon>
              </div>
              <h3>Sin tareas asignadas</h3>
              <p>Este miembro aún no tiene tareas asignadas</p>
            </div>
          }
        </mat-card-content>
      </mat-card>
    }
          </div>
        }
</div>

